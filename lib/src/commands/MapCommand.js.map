{"version":3,"sources":["../../../src/commands/MapCommand.js"],"names":["command","desc","builder","logParserErrors","alias","describe","type","default","useHtmlLabels","argumentLabelMode","choices","undefined","statementLabelMode","statementSelectionMode","graphName","lineLength","groupColors","inclusive","rankdir","concentrate","ratio","size","format","width","height","density","handler","argv","config","loadConfig","dot","DotExport","map","MapMaker","svgToPdf","SvgToPdfExportPlugin","svgToPng","SvgToPngExportPlugin","saveAs","SaveAsFilePlugin","excludeDisconnected","graphname","graphVizSettings","concentration","contentration","inputGlob","inputPath","outputDir","logLevel","verbose","watch","process","push","stdout","load","catch","e","console","log"],"mappings":"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","file":"MapCommand.js","sourcesContent":["import { app } from \"../index.js\";\n\nexport const command = \"map [inputGlob] [outputDir]\";\nexport const desc = \"export Argdown input as DOT files\";\nexport const builder = {\n    logParserErrors: {\n        alias: \"e\",\n        describe: \"Log parser errors to console\",\n        type: \"boolean\",\n        default: true\n    },\n    useHtmlLabels: {\n        alias: \"html-labels\",\n        describe: \"Use HTML node labels\",\n        type: \"boolean\"\n    },\n    argumentLabelMode: {\n        alias: \"argument-labels\",\n        choices: [undefined, \"hide-untitled\", \"title\", \"description\"],\n        type: \"string\",\n        describe: \"The method by which argument label content is selected\"\n    },\n    statementLabelMode: {\n        alias: \"statement-labels\",\n        choices: [undefined, \"hide-untitled\", \"title\", \"text\"],\n        type: \"string\",\n        describe: \"The method by which statement label content is selected\"\n    },\n    statementSelectionMode: {\n        alias: \"statement-selection\",\n        type: \"string\",\n        choices: [undefined, \"all\", \"titled\", \"roots\", \"statement-trees\", \"with-relations\"]\n    },\n    graphName: {\n        alias: \"name\",\n        type: \"string\",\n        describe: \"Name of the graph\"\n    },\n    lineLength: {\n        alias: \"line\",\n        type: \"number\",\n        describe: \"Number of chars in a label line.\"\n    },\n    groupColors: {\n        type: \"array\",\n        describe: \"Colors for groups sorted by stacking order\"\n    },\n    inclusive: {\n        type: \"boolean\",\n        describe: \"Include disconnected nodes.\"\n    },\n    rankdir: {\n        type: \"string\",\n        describe: \"Graphviz rankdir setting\"\n    },\n    concentrate: {\n        type: \"string\",\n        describe: \"Graphviz concentrate setting\"\n    },\n    ratio: {\n        type: \"string\",\n        describe: \"Graphviz ratio setting\"\n    },\n    size: {\n        type: \"string\",\n        describe: \"Graphviz size setting\"\n    },\n    format: {\n        alias: \"f\",\n        type: \"string\",\n        describe: \"the file format (dot, svg, pdf, png)\",\n        default: \"pdf\"\n    },\n    width: {\n        type: \"number\",\n        describe: \"the width of the png image (only used if format is png)\"\n    },\n    height: {\n        type: \"number\",\n        describe: \"the height of the png image (only used if format is png)\"\n    },\n    density: {\n        alias: \"d\",\n        type: \"number\",\n        describe: \"the dpi density of the png image (default is 72dpi)\"\n    }\n};\nexport const handler = function(argv) {\n    let config = app.loadConfig(argv.config);\n\n    config.dot = config.dot || config.DotExport || {};\n    config.map = config.map || config.MapMaker || {};\n    const format = argv.format || \"pdf\";\n    if (format === \"pdf\") {\n        config.svgToPdf = config.svgToPdf || config.SvgToPdfExportPlugin || {};\n    } else if (format === \"png\") {\n        config.svgToPng = config.svgToPng || config.SvgToPngExportPlugin || {};\n        if (argv.width) {\n            config.svgToPng.width = argv.width;\n        }\n        if (argv.height) {\n            config.svgToPng.height = argv.height;\n        }\n        if (argv.density) {\n            config.svgToPng.density = argv.density;\n        }\n    } else {\n        config.saveAs = config.saveAs || config.SaveAsFilePlugin || {};\n    }\n\n    if (argv.useHtmlLabels) {\n        config.dot.useHtmlLabels = true;\n    }\n\n    if (argv.argumentLabelMode) {\n        config.dot.argumentLabelMode = argv.argumentLabelMode;\n    }\n    if (argv.statementLabelMode) {\n        config.dot.statementLabelMode = argv.statementLabelMode;\n    }\n    if (argv.statementSelectionMode) {\n        config.map.statementSelectionMode = argv.statementSelectionMode;\n    }\n    if (argv.inclusive) {\n        config.map.excludeDisconnected = false;\n    }\n\n    if (argv.graphName) {\n        config.dot.graphname = argv.graphName;\n    }\n    if (argv.lineLength) {\n        config.dot.lineLength = argv.lineLength;\n    }\n    if (argv.groupColors) {\n        config.dot.groupColors = argv.groupColors;\n    }\n\n    config.dot.graphVizSettings = config.dot.graphVizSettings || {};\n    if (argv.concentration) {\n        config.dot.graphVizSettings.concentration = argv.contentration;\n    }\n    if (argv.size) {\n        config.dot.graphVizSettings.size = argv.size;\n    }\n    if (argv.ratio) {\n        config.dot.graphVizSettings.ratio = argv.ratio;\n    }\n    if (argv.rankdir) {\n        config.dot.graphVizSettings.rankdir = argv.rankdir;\n    }\n\n    if (argv.inputGlob) {\n        config.inputPath = argv.inputGlob;\n    }\n    if (argv.outputDir) {\n        if (format === \"pdf\") {\n            config.svgToPdf.outputDir = argv.outputDir;\n        } else if (format === \"png\") {\n            config.svgToPng.outputDir = argv.outputDir;\n        } else {\n            config.saveAs.outputDir = argv.outputDir;\n        }\n    }\n    config.logLevel = argv.verbose ? \"verbose\" : config.logLevel;\n    config.watch = argv.watch || config.watch;\n    config.process = [\"preprocessor\", \"parse-input\"];\n    config.logParserErrors = argv.logParserErrors || config.logParserErrors;\n    if (config.logParserErrors) {\n        config.process.push(\"log-parser-errors\");\n    }\n    config.process.push(\"build-model\");\n    config.process.push(\"export-dot\");\n    if (format !== \"dot\") {\n        config.process.push(\"export-svg\");\n    }\n    if (!argv.stdout || argv.outputDir) {\n        if (format === \"dot\") {\n            config.process.push(\"save-as-dot\");\n        } else if (format === \"svg\") {\n            config.process.push(\"save-svg-as-svg\");\n        } else if (format === \"png\") {\n            config.process.push(\"save-svg-as-png\");\n        } else {\n            config.process.push(\"save-svg-as-pdf\");\n        }\n    }\n\n    if (argv.stdout) {\n        if (format === \"dot\") {\n            config.process.push(\"stdout-dot\");\n        } else {\n            // pdf and png to stdout is currently not supported\n            config.process.push(\"stdout-svg\");\n        }\n    }\n    app.load(config).catch(e => console.log(e));\n};\n"]}