{"version":3,"sources":["../../src/index.js"],"names":["_","glob","require","fs","path","chokidar","requireUncached","app","modelPlugin","htmlExport","tagPlugin","mapMaker","dotExport","argmlExport","jsonExport","saveAsHtml","outputDir","dataKey","extension","copyDefaultCss","saveAsDot","saveAsArgML","saveAsJSON","stdoutDot","stdoutArgML","stdoutJSON","stdoutHtml","addPlugin","load","config","input","$","absoluteInputGlob","resolve","process","cwd","watch","watcher","watcherConfig","cloneDeep","on","verbose","console","log","er","files","file","readFileSync","saveAs","sourceFile","run","e","loadJSFile","filePath","absoluteFilePath","message","loadConfig","jsModuleExports","CopyDefaultCssPlugin","SaveAsFilePlugin"],"mappings":"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","file":"index.js","sourcesContent":["import {ArgdownApplication, ModelPlugin, HtmlExport, JSONExport, TagPlugin} from 'argdown-parser';\nimport {MapMaker, DotExport, ArgMLExport} from 'argdown-map-maker';\nimport {SaveAsFilePlugin} from './plugins/SaveAsFilePlugin.js';\nimport {CopyDefaultCssPlugin} from './plugins/CopyDefaultCssPlugin.js';\nimport {StdOutPlugin} from './plugins/StdOutPlugin.js';\nimport * as _ from 'lodash';\n\nlet glob = require('glob');\nlet fs = require('fs');\nlet path = require('path');\nlet chokidar = require('chokidar');\nlet requireUncached = require(\"require-uncached\");\n\nconst app = new ArgdownApplication();\nconst modelPlugin = new ModelPlugin();\nconst htmlExport = new HtmlExport();\nconst tagPlugin = new TagPlugin();\nconst mapMaker = new MapMaker();\nconst dotExport = new DotExport();\nconst argmlExport = new ArgMLExport();\nconst jsonExport = new JSONExport();\nconst saveAsHtml = new SaveAsFilePlugin({\n  outputDir: './html',\n  dataKey: 'html',\n  extension: '.html'\n});\nconst copyDefaultCss = new CopyDefaultCssPlugin();\n\nconst saveAsDot = new SaveAsFilePlugin({\n  outputDir: './dot',\n  dataKey: 'dot',\n  extension: '.dot'\n});\nconst saveAsArgML = new SaveAsFilePlugin({\n  outputDir: './graphml',\n  dataKey: 'argml',\n  extension: '.graphml'\n});\nconst saveAsJSON = new SaveAsFilePlugin({\n  outputDir: './json',\n  dataKey: 'json',\n  extension: '.json'\n});\nconst stdoutDot = new StdOutPlugin({dataKey:'dot'});\nconst stdoutArgML = new StdOutPlugin({dataKey:'argml'});\nconst stdoutJSON = new StdOutPlugin({dataKey:'json'});\nconst stdoutHtml = new StdOutPlugin({dataKey:'html'});\n\napp.addPlugin(modelPlugin, \"build-model\");\napp.addPlugin(tagPlugin, \"build-model\");\n\napp.addPlugin(htmlExport, \"export-html\");\napp.addPlugin(copyDefaultCss, \"copy-default-css\");\napp.addPlugin(saveAsHtml, \"save-as-html\");\napp.addPlugin(stdoutHtml, \"stdout-html\");\n\napp.addPlugin(mapMaker, \"export-json\");\napp.addPlugin(jsonExport, \"export-json\");\napp.addPlugin(saveAsJSON, \"save-as-json\");\napp.addPlugin(stdoutJSON, \"stdout-json\");\n\napp.addPlugin(mapMaker, \"export-dot\");\napp.addPlugin(dotExport, \"export-dot\");\napp.addPlugin(saveAsDot, \"save-as-dot\");\napp.addPlugin(stdoutDot, \"stdout-dot\");\n\napp.addPlugin(mapMaker, \"export-argml\");\napp.addPlugin(argmlExport, \"export-argml\");\napp.addPlugin(saveAsArgML, \"save-as-argml\");\napp.addPlugin(stdoutArgML, \"stdout-argml\");\n\napp.load = function(config){\n  if(!config.input){\n    config.input = \"./*.argdown\";\n  }\n  const $ = this;\n  let absoluteInputGlob = path.resolve(process.cwd(),config.input);\n  if(config.watch){\n    const watcher = chokidar.watch(absoluteInputGlob, {});\n    const watcherConfig = _.cloneDeep(config);\n    watcherConfig.watch = false;\n    \n    watcher\n    .on('add', path => {\n      if(config.verbose){\n        console.log(`File ${path} has been added.`);        \n      }\n      watcherConfig.input = path;\n      $.load(watcherConfig);\n    })\n    .on('change', path => {\n      if(config.verbose){\n        console.log(`File ${path} has been changed.`);        \n      }\n      watcherConfig.input = path;\n      $.load(watcherConfig);\n    })\n    .on('unlink', path => {\n      if(config.verbose){\n        console.log(`File ${path} has been removed.`);        \n      }\n    });    \n  }else{\n    glob(absoluteInputGlob, function (er, files) {\n      if(er){\n        console.log(er);\n        return;\n      }else{\n        for(let file of files){\n          if(config.verbose){\n            console.log(\"Processing file: \"+file);\n          }\n          try{\n            const input = fs.readFileSync(file, 'utf8');\n            config.saveAs = config.saveAs ||{};\n            config.saveAs.sourceFile = file;\n            $.run({input: input, config:config});            \n          }catch(e){\n            console.log(e);\n          }\n        }\n      }\n    });    \n  }\n}\n\n/**\n * Taken from eslint: https://github.com/eslint/eslint/blob/master/lib/config/config-file.js\n * Loads a JavaScript configuration from a file.\n * @param {string} filePath The filename to load.\n * @returns {Object} The configuration object from the file.\n * @throws {Error} If the file cannot be read.\n * @private\n */\napp.loadJSFile = function loadJSFile(filePath) {\n    let absoluteFilePath = path.resolve(process.cwd(), filePath);\n    try {\n        return requireUncached(absoluteFilePath);\n    } catch (e) {\n        e.message = `Cannot read file: ${absoluteFilePath}\\nError: ${e.message}`;\n        throw e;\n    }\n}\n\napp.loadConfig = function(filePath){\n  filePath = filePath || './argdown.config.js';\n  let config = {};\n  try{\n    let jsModuleExports = this.loadJSFile(filePath);\n    if(jsModuleExports.config){\n      config = jsModuleExports.config;\n    }else{ // let's try the default export\n      config = jsModuleExports;\n    }\n  }catch(e){\n    // console.log(e);\n  }\n  return config;\n}\n\nexport {\n  app, CopyDefaultCssPlugin, SaveAsFilePlugin\n};\n"]}