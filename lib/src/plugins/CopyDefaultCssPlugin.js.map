{"version":3,"sources":["../../../src/plugins/CopyDefaultCssPlugin.js"],"names":["_","fs","require","path","mkdirp","CopyDefaultCssPlugin","constructor","config","name","defaults","defaultsDeep","outputDir","getSettings","request","copyDefaultCss","prepare","settings","html","saveAs","runAsync","response","logger","rootPath","process","cwd","outputPath","dirname","absoluteOutputDir","resolve","Promise","reject","err","pathToDefaultCssFile","log","COPYFILE_EXCL","constants","copyFile","module","exports"],"mappings":";;AAGA;;IAAYA,C;;;;AAHZ,IAAIC,KAAKC,QAAQ,IAAR,CAAT;AACA,IAAIC,OAAOD,QAAQ,MAAR,CAAX;AACA,IAAIE,SAASF,QAAQ,QAAR,CAAb;;;AAGA,MAAMG,oBAAN,CAA2B;AACzBC,cAAYC,MAAZ,EAAoB;AAClB,SAAKC,IAAL,GAAY,sBAAZ;AACA,SAAKC,QAAL,GAAgBT,EAAEU,YAAF,CAAe,EAAf,EAAmBH,MAAnB,EAA2B;AACzCI,iBAAW;AAD8B,KAA3B,CAAhB;AAGD;AACDC,cAAYC,OAAZ,EAAqB;AACnB,QAAI,CAACA,QAAQC,cAAb,EAA6B;AAC3BD,cAAQC,cAAR,GAAyB,EAAzB;AACD;AACD,WAAOD,QAAQC,cAAf;AACD;AACDC,UAAQF,OAAR,EAAiB;AACf,UAAMG,WAAW,KAAKJ,WAAL,CAAiBC,OAAjB,CAAjB;AACAb,MAAEU,YAAF,CAAeM,QAAf,EAAyB,KAAKP,QAA9B;AACA,QAAII,QAAQI,IAAR,IAAgBJ,QAAQI,IAAR,CAAaN,SAAjC,EAA4C;AAC1CK,eAASL,SAAT,GAAqBE,QAAQI,IAAR,CAAaN,SAAlC;AACD,KAFD,MAEO,IAAIE,QAAQK,MAAR,IAAkBL,QAAQK,MAAR,CAAeP,SAArC,EAAgD;AACrDK,eAASL,SAAT,GAAqBE,QAAQK,MAAR,CAAeP,SAApC;AACD;AACF;AACD,QAAMQ,QAAN,CAAeN,OAAf,EAAwBO,QAAxB,EAAkCC,MAAlC,EAA0C;AACxC,UAAML,WAAW,KAAKJ,WAAL,CAAiBC,OAAjB,CAAjB;AACA,QAAIS,WAAWT,QAAQS,QAAR,IAAoBC,QAAQC,GAAR,EAAnC;AACA,QAAIb,YAAYE,QAAQY,UAAR,GACZtB,KAAKuB,OAAL,CAAab,QAAQY,UAArB,CADY,GAEZT,SAASL,SAFb;AAGA,QAAIgB,oBAAoBxB,KAAKyB,OAAL,CAAaN,QAAb,EAAuBX,SAAvB,CAAxB;AACA,UAAM,IAAIkB,OAAJ,CAAY,CAACD,OAAD,EAAUE,MAAV,KAAqB;AACrC1B,aAAOuB,iBAAP,EAA0B,UAASI,GAAT,EAAc;AACtC,YAAIA,GAAJ,EAAS;AACPD,iBAAOC,GAAP;AACD;AACDH;AACD,OALD;AAMD,KAPK,CAAN;AAQA,QAAII,uBAAuB9B,QAAQ0B,OAAR,CACzB,4CADyB,CAA3B;AAGAP,WAAOY,GAAP,CACE,SADF,EAEE,4CAA4CN,iBAF9C;AAIA,UAAM,EAAEO,aAAF,KAAoBjC,GAAGkC,SAA7B;AACA,UAAM,IAAIN,OAAJ,CAAY,CAACD,OAAD,EAAUE,MAAV,KAAqB;AACrC7B,SAAGmC,QAAH,CACEJ,oBADF,EAEE7B,KAAKyB,OAAL,CAAaD,iBAAb,EAAgC,aAAhC,CAFF,EAGEO,aAHF,EAIEH,OAAO;AACL,YAAIA,GAAJ,EAAS;AACPD,iBAAOC,GAAP;AACD;AACDH;AACD,OATH;AAWD,KAZK,CAAN;AAaD;AA1DwB;AA4D3BS,OAAOC,OAAP,GAAiB;AACfjC,wBAAsBA;AADP,CAAjB","file":"CopyDefaultCssPlugin.js","sourcesContent":["let fs = require(\"fs\");\nlet path = require(\"path\");\nlet mkdirp = require(\"mkdirp\");\nimport * as _ from \"lodash\";\n\nclass CopyDefaultCssPlugin {\n  constructor(config) {\n    this.name = \"CopyDefaultCssPlugin\";\n    this.defaults = _.defaultsDeep({}, config, {\n      outputDir: \"./html\"\n    });\n  }\n  getSettings(request) {\n    if (!request.copyDefaultCss) {\n      request.copyDefaultCss = {};\n    }\n    return request.copyDefaultCss;\n  }\n  prepare(request) {\n    const settings = this.getSettings(request);\n    _.defaultsDeep(settings, this.defaults);\n    if (request.html && request.html.outputDir) {\n      settings.outputDir = request.html.outputDir;\n    } else if (request.saveAs && request.saveAs.outputDir) {\n      settings.outputDir = request.saveAs.outputDir;\n    }\n  }\n  async runAsync(request, response, logger) {\n    const settings = this.getSettings(request);\n    let rootPath = request.rootPath || process.cwd();\n    let outputDir = request.outputPath\n      ? path.dirname(request.outputPath)\n      : settings.outputDir;\n    let absoluteOutputDir = path.resolve(rootPath, outputDir);\n    await new Promise((resolve, reject) => {\n      mkdirp(absoluteOutputDir, function(err) {\n        if (err) {\n          reject(err);\n        }\n        resolve();\n      });\n    });\n    let pathToDefaultCssFile = require.resolve(\n      \"argdown-parser/lib/src/plugins/argdown.css\"\n    );\n    logger.log(\n      \"verbose\",\n      \"Copying default argdown.css to folder: \" + absoluteOutputDir\n    );\n    const { COPYFILE_EXCL } = fs.constants;\n    await new Promise((resolve, reject) => {\n      fs.copyFile(\n        pathToDefaultCssFile,\n        path.resolve(absoluteOutputDir, \"argdown.css\"),\n        COPYFILE_EXCL,\n        err => {\n          if (err) {\n            reject(err);\n          }\n          resolve();\n        }\n      );\n    });\n  }\n}\nmodule.exports = {\n  CopyDefaultCssPlugin: CopyDefaultCssPlugin\n};\n"]}