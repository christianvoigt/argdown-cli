{"version":3,"sources":["../../../src/plugins/SvgToPdfExport.js"],"names":["_","PDFDocument","require","fs","path","mkdirp","SvgToPdfExport","config","previousSettings","settings","outputDir","defaultsDeep","format","name","data","logger","svgToPdf","svg","fileName","isEmpty","sourceFile","isString","getFileName","isFunction","call","input","absoluteOutputDir","resolve","process","cwd","filePath","err","log","doc","pipe","createWriteStream","end","file","extension","extname","basename","module","exports"],"mappings":"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","file":"SvgToPdfExport.js","sourcesContent":["// We have to use a local file and let babel ignore it, until pdfkit is ported to ES6\nvar PDFDocument = require('../pdfkit.js');\nvar fs = require('fs');\nlet path = require('path');\nlet mkdirp = require('mkdirp');\nimport SVGtoPDF from 'svg-to-pdfkit';\nimport * as _ from 'lodash';\n\nclass SvgToPdfExport {\n    set config(config) {\n        let previousSettings = this.settings;\n        if (!previousSettings) {\n            previousSettings = {\n                outputDir: \"./pdf\"\n            };\n        }\n        this.settings = _.defaultsDeep({}, config, previousSettings);\n        // enforce svg export\n        this.settings.format = 'svg';\n    }\n    constructor(config) {\n        this.name = \"SvgToPdfExport\";\n        this.config = config;\n    }\n    run(data, logger) {\n        if (data.config) {\n            if (data.config.svgToPdf) {\n                this.config = data.config.svgToPdf;\n            } else if (data.config.SvgToPdfExport) {\n                this.config = data.config.SvgToPdfExport;\n            }\n        }\n        if (!data.svg) {\n            return data;\n        }\n        let fileName = 'default';\n        if(!_.isEmpty(this.settings.sourceFile) && _.isString(this.settings.sourceFile)){\n            fileName = this.getFileName(this.settings.sourceFile);\n        }else if(_.isFunction(this.settings.fileName)){\n            fileName = this.settings.fileName.call(this, data);\n        }else if(_.isString(this.settings.fileName)){\n            fileName = this.settings.fileName;\n        }else if(data.config && data.config.input){\n            fileName = this.getFileName(data.config.input);\n        }\n        const absoluteOutputDir = path.resolve(process.cwd(), this.settings.outputDir);\n        const filePath = absoluteOutputDir + '/' + fileName + '.pdf';\n        const settings = this.settings;\n        mkdirp(absoluteOutputDir, function (err) {\n            if (err) {\n                logger.log(\"error\", err);\n            } else {\n                var doc = new PDFDocument(settings);\n                doc.pipe(fs.createWriteStream(filePath));\n                SVGtoPDF(doc, data.svg, 0, 0, settings);\n                doc.end();\n            }\n        });\n        return data;\n    }\n    getFileName(file) {\n        let extension = path.extname(file);\n        return path.basename(file, extension);\n    }\n}\nmodule.exports = {\n    SvgToPdfExport: SvgToPdfExport\n}\n"]}