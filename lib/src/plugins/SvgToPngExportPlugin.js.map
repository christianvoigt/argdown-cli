{"version":3,"sources":["../../../src/plugins/SvgToPngExportPlugin.js"],"names":["_","svg2png","require","fs","path","mkdirp","SvgToPngExportPlugin","config","previousSettings","settings","outputDir","defaultsDeep","format","name","data","logger","svgToPng","svg","fileName","isFunction","call","isString","inputFile","getFileName","absoluteOutputDir","resolve","process","cwd","filePath","err","log","options","width","height","outputBuffer","sync","writeFile","file","extension","extname","basename","module","exports"],"mappings":"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","file":"SvgToPngExportPlugin.js","sourcesContent":["// We have to use a local file and let babel ignore it, until pdfkit is ported to ES6\nconst svg2png = require(\"svg2png\");\nvar fs = require('fs');\nlet path = require('path');\nlet mkdirp = require('mkdirp');\nimport * as _ from 'lodash';\n\nclass SvgToPngExportPlugin {\n    set config(config) {\n        let previousSettings = this.settings;\n        if (!previousSettings) {\n            previousSettings = {\n                outputDir: \"./png\"\n            };\n        }\n        this.settings = _.defaultsDeep({}, config, previousSettings);\n        // enforce svg export\n        this.settings.format = 'png';\n    }\n    constructor(config) {\n        this.name = \"SvgToPngExportPlugin\";\n        this.config = config;\n    }\n    run(data, logger) {\n        if (data.config) {\n            if (data.config.svgToPng) {\n                this.config = data.config.svgToPng;\n            } else if (data.config.SvgToPngExportPlugin) {\n                this.config = data.config.SvgToPngExportPlugin;\n            }\n        }\n        if (!data.svg) {\n            return data;\n        }\n        let fileName = 'default';\n        if (_.isFunction(this.settings.fileName)) {\n            fileName = this.settings.fileName.call(this, data);\n        } else if (_.isString(this.settings.fileName)) {\n            fileName = this.settings.fileName;\n        } else if (data.inputFile) {\n            fileName = this.getFileName(data.inputFile);\n        }\n        const absoluteOutputDir = path.resolve(process.cwd(), this.settings.outputDir);\n        const filePath = absoluteOutputDir + '/' + fileName + '.png';\n        const settings = this.settings;\n        mkdirp(absoluteOutputDir, function (err) {\n            if (err) {\n                logger.log(\"error\", err);\n            } else {\n                const options = {};\n                if(settings.width){\n                    options.width = settings.width;\n                }\n                if(settings.height){\n                    options.height = settings.height;\n                }\n                const outputBuffer = svg2png.sync(data.svg, options);\n                fs.writeFile(filePath, outputBuffer, function (err) {\n                    if (err) {\n                        logger.log(\"error\", err);\n                    }\n                    logger.log(\"verbose\", \"Saved \" + filePath);\n                });\n            }\n        });\n        return data;\n    }\n    getFileName(file) {\n        let extension = path.extname(file);\n        return path.basename(file, extension);\n    }\n}\nmodule.exports = {\n    SvgToPngExportPlugin: SvgToPngExportPlugin\n}\n"]}